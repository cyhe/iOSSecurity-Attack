## LLDB+debugserveråŠ¨æ€è°ƒè¯•

##LLDB(Low Level Debugger)
* å†…ç½®äºXcodeä¸­çš„åŠ¨æ€è°ƒè¯•å·¥å…·,é€šåƒC,C++,OC,å…¨ç›˜æ”¯æŒOSX,iOS,iOSæ¨¡æ‹Ÿå™¨
* åœ¨æŒ‡å®šçš„æ¡ä»¶ä¸‹å¯åŠ¨ç¨‹åº;
* åœ¨æŒ‡å®šçš„æ¡ä»¶ä¸‹åœæ­¢ç¨‹åº;
* åœ¨ç¨‹åºåœæ­¢çš„æ—¶å€™æ£€æŸ¥ç¨‹åºå†…éƒ¨å‘ç”Ÿçš„äº‹;
* åœ¨ç¨‹åºåœæ­¢çš„æ—¶å€™å¯¹ç¨‹åºè¿›è¡Œæ”¹åŠ¨,è§‚å¯Ÿç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹æœ‰ä»€ä¹ˆå˜åŒ–

>LLDBæ˜¯è¿è¡Œåœ¨OSXä¸­çš„,è¦æƒ³è°ƒè¯•iOS,éœ€è¦å’Œdebugserverè¿›è¡Œé…åˆ.
debugserverè¿è¡Œåœ¨iOSä¸Š,ä½œä¸ºæœåŠ¡å™¨,å®é™…ä¸Šæ‰§è¡ŒLLDBä¼ è¿‡æ¥çš„å‘½ä»¤,å†æŠŠæ‰§è¡Œç»“æœåé¦ˆç»™LLDB,æ˜¾ç¤ºç»™ç”¨æˆ·,å³æ‰€è°“çš„è¿œç¨‹è°ƒè¯•,é»˜è®¤iOSè®¾å¤‡ä¸Šå¹¶æ²¡æœ‰debugserver,åªæœ‰åœ¨è®¾å¤‡è¿æ¥ä¸€æ¬¡Xcode,åœ¨Windows-->Deviceèœå•ä¸­æ·»åŠ æ­¤è®¾å¤‡å, debugserveræ‰ä¼šè¢«Xcodeå®‰è£…åˆ°iOSçš„"/Developer/usr/bin/"ç›®å½•ä¸‹.


-->ä¸Šè¿°æ˜¯æ­£å‘å¼€å‘è°ƒè¯•ç”¨çš„
##é€†å‘è¦é…ç½®debugserver+LLDB

 ![æ“ä½œæ­¥éª¤](http://o7pqb42yk.bkt.clouddn.com/%E6%AD%A5%E9%AA%A4.jpg)

* 1.å°†æœªå¤„ç†çš„debugserveræ‹·è´åˆ°/User/esirnusä¸‹
* 2.å¸®å®ƒç˜¦èº«(ps:æˆ‘ä¹ŸğŸ˜â–âœˆï¸)
* 3.å»<http://iosre.com/ent.xml>ä¸‹è½½ent.xmlç„¶åæ‹·è´åˆ°/User/esirnusä¸‹,ç»™debugserveræ·»åŠ task_for_pidæƒé™,æ³¨æ„-Sent.xmlä¹‹é—´æ²¡æœ‰ç©ºæ ¼
* 4.å°†ç»è¿‡å¤„ç†çš„debugserveræ‹·è´å›iOSçš„/usr/binç›®å½•ä¸‹
* 5.sshåˆ°iOS
* 6.ç»™æ‹·è´å›çš„debugserveræ·»åŠ æƒé™
* æ²¡æœ‰å°†debugserveræ‹·è´å›åŸæ–‡ä»¶å¤¹,ä¸€æ˜¯å› ä¸º/Developer/usr/binä¸‹çš„åŸç‰ˆdebugserveræ˜¯ä¸å¯å†™çš„,äºŒæ˜¯å› ä¸º/usr/binä¸‹çš„å‘½ä»¤æ— é¡»è¾“å…¥å…¨è·¯å¾„å°±å¯ä»¥æ‰§è¡Œ,å³åœ¨ä»»æ„ç›®å½•ä¸‹è¿è¡Œdebugserveréƒ½å¯ä»¥å¯åŠ¨å¤„ç†å¤šçš„debugserver.


##debugserveræœ€å¸¸ç”¨çš„æ˜¯å¯åŠ¨å’Œé™„åŠ è¿›ç¨‹

* debugserverä¼šå¯åŠ¨executable,å¹¶å¼€å¯portç«¯å£,ç­‰å¾…æ¥è‡ªIPçš„LLDBçš„æ¥å…¥

~~~
debugserver -x backboard IP:port /path/to/executable
~~~

* debugserverä¼šé™„åŠ ProcessName,å¹¶å¼€å¯portç«¯å£,ç­‰å¾…æ¥è‡ªIPçš„LLDBçš„æ¥å…¥

~~~
debugserver IP:port -a "ProcessName"
~~~

*eg*:
*å¯åŠ¨AppStore,å¹¶å¼€å¯1234ç«¯å£,ç­‰å¾…ä»»æ„çš„IPåœ°å€çš„LLDBæ¥å…¥*

~~~
debugserver -x backboard 192.168.35.252:1234 /Applications/AppStore.app/AppStore
~~~

*eg:*
*ä¼šé™„åŠ AppStore,å¹¶å¼€å¯1234ç«¯å£,ç­‰å¾…ä»»æ„çš„IPåœ°å€çš„LLDBæ¥å…¥*

~~~
debugserver 192.168.35.252:1234 -a "AppStore"
~~~

**ps:ä¸¤ä¸ªæ³¨æ„ç‚¹:1.ä¸€å®šè¦å¼€å¯ç«¯å£å·(:1234),1234ç«¯å£å·æ˜¯è‡ªå·±æŒ‡å®šçš„;2.iOSä¸Šçš„"/Develpoer/"ç›®å½•ä¸‹ç¼ºå°‘å¿…è¦çš„è°ƒè¯•æ•°æ®,è¿™ç§æƒ…å†µä¸€èˆ¬æ˜¯æ²¡æœ‰åœ¨Xcodeä¸­æ·»åŠ è®¾å¤‡,åœ¨Xcode-->Window-->Devicesèœå•ä¸­æ·»åŠ è®¾å¤‡(é ....åˆ‡è®°åˆ‡è®°,æŠ˜è…¾äº†ä¸€å¤©,ğŸ˜¢);**

*é…ç½®å¥½debugserveråå¯åŠ¨Xcodeçš„LLDBå°±å¯ä»¥è°ƒè¯•äº†(æ³¨:X6çš„lldbæœ‰bug,åœ¨armv7å’Œarmv7sä¸Šè®¾å¤‡ä¸Šæœ‰æ—¶ä¼šæ··æ·†ARMå’ŒTHUMBæŒ‡ä»¤,å¯¼è‡´æ— æ³•è°ƒè¯•,X7å·²ä¿®å¤)*

![å¯åŠ¨è¿æ¥å‘½ä»¤](http://o7pqb42yk.bkt.clouddn.com/1DBBE39E-D211-4B7F-86FD-5E246E6CBFB2.png)
é€šè¿‡æ­¤å‘½ä»¤å¯åŠ¨å,è€—æ—¶è¾ƒé•¿,åœ¨è¿›ç¨‹åœæ­¢åå°±å¯ä»¥å¼€å§‹è°ƒè¯•äº†

##LLDBå‘½ä»¤
#### 1.*imagelist*
* **iamge list ä¸GDBä¸­çš„"info shared"ç±»ä¼¼,ç”¨äºåˆ—ä¸¾å½“å‰è¿›ç¨‹ä¸­çš„æ‰€æœ‰æ¨¡å—(image).å› ä¸ºASLRçš„å…³ç³»,æ¯æ¬¡è¿›ç¨‹å¯åŠ¨æ—¶å€™,åŒä¸€è¿›ç¨‹çš„æ‰€æœ‰æ¨¡å—ä¼šåœ¨è™šæ‹Ÿå†…å­˜ä¸­çš„èµ·å§‹åœ°å€éƒ½ä¼šäº§ç”Ÿéšæœºåç§»**

>**å¦‚**:*è¿›ç¨‹Aä¸­æœ‰ä¸€ä¸ªæ¨¡å—B,Bçš„æ¨¡å—å¤§å°æ˜¯100å­—èŠ‚,è¿›ç¨‹Aç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶,æ¨¡å—Bå¯èƒ½ä¼šè¢«åŠ è½½åˆ°è™šæ‹Ÿå†…å­˜çš„0x00åˆ°oxC4,ç¬¬äºŒæ¬¡å¯åŠ¨ä¼šè¢«åŠ è½½åˆ°0x10åˆ°0x74,ç¬¬ä¸‰æ¬¡å¯åŠ¨ä¼šåˆ«åŠ è½½åˆ°0x60åˆ°0xC4,ä¹Ÿå°±æ˜¯è¯´å®ƒçš„å¤§å°è™½ç„¶æ²¡å˜,ä½†èµ·å§‹åœ°å€æ¯æ¬¡éƒ½åœ¨å˜åŒ–,è€Œè¿™ä¸ªåœ°å€å°±æ˜¯ä¼šé¢‘ç¹ç”¨åˆ°çš„ä¸€ä¸ªå…³é”®æ•°æ®---->è·å¾—è¿™ä¸ªæ•°æ®çš„é€”å¾„:LLDBå¯åŠ¨å,è¾“å…¥"image list -o -f"å‘½ä»¤*

>*æ¨¡å—åœ¨å†…å­˜ä¸­èµ·å§‹åœ°å€--->* **æ¨¡å—åŸºåœ°å€(image base adress)** 



>**NSLogçš„åŸºåœ°å€ = NSLogåœ¨Foundationä¸­çš„ç›¸å¯¹ä½ç½® + Foudationçš„åŸºåœ°å€**

* å…¬å¼æ¨å¯¼:

>**åç§»åæ¨¡å—åŸºåœ°å€ = åç§»å‰æ¨¡å—åŸºåœ°å€ + ALSRåç§»**

>**åç§»åç¬¦å·åŸºåœ°å€ = åç§»å‰ç¬¦å·åŸºåœ°å€ + ç¬¦å·æ‰€åœ¨æ¨¡å—çš„ALSRåç§»**

>**åç§»åæŒ‡ä»¤åŸºåœ°å€ = åç§»å‰ç¬¦å·åŸºåœ°å€ + æŒ‡ä»¤æ‰€åœ¨æ¨¡å—çš„ALSRåç§»**

#### 2.*breakpoint*
* "breakpoint"ä¸GDBä¸­çš„"break"ç±»ä¼¼,ç”¨äºè®¾ç½®æ–­ç‚¹.åœ¨é€†å‘å·¥ç¨‹ä¸­ä¸€èˆ¬ç”¨åˆ°çš„æ˜¯

>b function
>>åœ¨å‡½æ•°çš„èµ·å§‹ä½ç½®è®¾ç½®æ–­ç‚¹,å¦‚:*(lldb) b NSLog*

>æˆ–è€…

>br s -a address  **ä»¥åŠ**  br s -a "ASLROffset+address"
>>åä¸¤è€…åœ¨åœ°å€å¤„è®¾ç½®æ–­ç‚¹,å¦‚:*(lldb) br s -a 0XCCCCC*

#### 3.*print*
> æœ¬æ–‡å¼€å¤´æ—¶è¯´é“LLDBçš„ä¸»è¦åŠŸèƒ½ä¹‹ä¸€æ˜¯"åœ¨ç¨‹åºåœæ­¢çš„æ—¶å€™æ£€æŸ¥ç¨‹åºå†…éƒ¨å‘ç”Ÿçš„äº‹",è€Œè¿™ä¸€åŠŸèƒ½å°±æ˜¯é€šè¿‡printå‘½ä»¤å®Œæˆçš„,å®ƒå¯ä»¥æ‰“å°æŸå¤„çš„å€¼

#### 4.*nexti&&stepi*
>nextiå’Œstepiçš„ä½œç”¨éƒ½æ˜¯æ‰§è¡Œä¸‹ä¸€è¡Œæœºå™¨æŒ‡ä»¤,å®ƒä»¬æœ€å¤§çš„åŒºåˆ«æ˜¯nextiä¸è¿›å…¥å‡½æ•°ä½“,è€Œstepiä¼šè¿›å…¥å‡½æ•°ä½“,å¯ä»¥ç®€å†™ä¸ºni,si;

#### 5.*register write*
>register write å‘½ä»¤ç”¨äºç»™æŒ‡å®šçš„å¯„å­˜å™¨èµ‹å€¼,ä»è€Œ"å¯¹ç¨‹åºè¿›è¡Œæ”¹åŠ¨,è§‚å¯Ÿç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹æœ‰ä»€ä¹ˆå˜åŒ–".























